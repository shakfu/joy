#
#   module  : CMakeLists.txt
#   version : 2.1
#   date    : 01/20/26
#
set(JOY_EXECUTABLE $<TARGET_FILE:joy>)
set(TEST_RUNNER "${CMAKE_SOURCE_DIR}/tools/run_test.sh")
set(TEST2_SOURCE_DIR "${CMAKE_SOURCE_DIR}/tests/test2")
set(TEST2_OUTPUT_DIR "${CMAKE_CURRENT_BINARY_DIR}")

# Macro to create custom target for output generation (for manual inspection)
macro(exe9 src)
add_custom_target(${src}.out ALL
          WORKING_DIRECTORY ${TEST2_SOURCE_DIR}
          DEPENDS joy ${TEST2_SOURCE_DIR}/${src}.joy
          COMMAND ${JOY_EXECUTABLE} ${TEST2_SOURCE_DIR}/${src}.joy >${TEST2_OUTPUT_DIR}/${src}.out)
endmacro(exe9)

# Macro to add CTest test
macro(joy_test src)
add_test(NAME test2_${src}
         COMMAND ${TEST_RUNNER} ${JOY_EXECUTABLE} ${CMAKE_SOURCE_DIR} ${CMAKE_SOURCE_DIR}/tests/test2/${src}.joy
         WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
endmacro(joy_test)

# Generate output files (existing functionality)
exe9(__dump)
exe9(__html_manual)
exe9(__latex_manual)
exe9(__manual_list)
exe9(__memoryindex)
exe9(__memorymax)
exe9(__settracegc)
exe9(__symtabindex)
exe9(__symtabmax)
exe9(_help)
exe9(abort)
exe9(abs)
exe9(acos)
exe9(all2)
exe9(and)
exe9(app1)
exe9(app11)
exe9(app12)
exe9(app2)
exe9(app3)
exe9(app4)
exe9(argc)
exe9(argv)
exe9(asin)
exe9(assign)
exe9(at)
exe9(atan)
exe9(atan2)
exe9(autoput)
exe9(binary)
exe9(binrec)
exe9(body)
exe9(branch)
exe9(case)
exe9(cases)
exe9(casting)
exe9(ceil)
exe9(char)
exe9(choice)
exe9(chr)
exe9(cleave)
exe9(clock)
exe9(compare)
exe9(concat)
exe9(cond)
exe9(condlinrec)
exe9(condnestrec)
exe9(cons)
exe9(construct)
exe9(conts)
exe9(cos)
exe9(cosh)
exe9(dict)
exe9(dip)
exe9(div)
exe9(divide)
exe9(drop)
exe9(dup)
exe9(dupd)
exe9(echo)
exe9(enconcat)
exe9(eql)
exe9(eql2)
exe9(equal)
exe9(exp)
exe9(false)
exe9(fclose)
exe9(feof)
exe9(ferror)
exe9(fflush)
exe9(fgetch)
exe9(fgets)
exe9(file)
exe9(filetime)
exe9(filter)
exe9(finclude)
exe9(first)
exe9(float)
exe9(floor)
exe9(fold)
exe9(fopen)
exe9(format)
exe9(formatf)
exe9(fput)
exe9(fputch)
exe9(fputchars)
exe9(fputstring)
exe9(fread)
exe9(fremove)
exe9(frename)
exe9(frexp)
exe9(fseek)
exe9(ftell)
exe9(fwrite)
exe9(gc)
exe9(genrec)
exe9(geql)
exe9(get)
exe9(getenv)
exe9(gmtime)
exe9(greater)
exe9(has)
exe9(help)
exe9(helpdetail)
exe9(i)
exe9(id)
exe9(ifchar)
exe9(iffile)
exe9(iffloat)
exe9(ifinteger)
exe9(iflist)
exe9(iflogical)
exe9(ifset)
exe9(ifstring)
exe9(ifte)
exe9(in)
exe9(include)
exe9(infra)
exe9(integer)
exe9(intern)
exe9(json)
exe9(ldexp)
exe9(leaf)
exe9(leql)
exe9(less)
exe9(let)
exe9(linrec)
exe9(list)
exe9(localtime)
exe9(log)
exe9(log10)
exe9(logical)
exe9(manual)
exe9(map)
exe9(match)
exe9(matrix)
exe9(max)
exe9(maxint)
exe9(min)
exe9(minus)
exe9(mktime)
exe9(modf)
exe9(mul)
exe9(name)
exe9(neg)
exe9(neql)
exe9(not)
exe9(null)
exe9(nullary)
exe9(of)
exe9(opcase)
exe9(or)
exe9(ord)
exe9(over)
exe9(pick)
exe9(plus)
exe9(pop)
exe9(popd)
exe9(pow)
exe9(pred)
exe9(primrec)
exe9(put)
exe9(putch)
exe9(putchars)
exe9(quit)
exe9(rand)
exe9(rem)
exe9(rest)
exe9(rolldown)
exe9(rolldownd)
exe9(rollup)
exe9(rollupd)
exe9(rotate)
exe9(rotated)
exe9(round)
exe9(sametype)
exe9(set)
exe9(setautoput)
exe9(setecho)
exe9(setsize)
exe9(setundeferror)
exe9(sign)
exe9(sin)
exe9(sinh)
exe9(size)
exe9(small)
exe9(some)
exe9(split)
exe9(sqrt)
exe9(srand)
exe9(stack)
exe9(stderr)
exe9(stdin)
exe9(stdout)
exe9(step)
exe9(strftime)
exe9(string)
exe9(strtod)
exe9(strtol)
exe9(succ)
exe9(swap)
exe9(swapd)
exe9(swons)
exe9(system)
exe9(tailrec)
exe9(take)
exe9(tan)
exe9(tanh)
exe9(ternary)
exe9(time)
exe9(times)
exe9(treegenrec)
exe9(treerec)
exe9(treestep)
exe9(true)
exe9(trunc)
exe9(typeof)
exe9(unary)
exe9(unary2)
exe9(unary3)
exe9(unary4)
exe9(unassign)
exe9(uncons)
exe9(undeferror)
exe9(undefs)
exe9(unstack)
exe9(unswons)
exe9(user)
exe9(vector)
exe9(while)
exe9(x)
exe9(xor)
exe9(strinterp)

# CTest tests - these verify assertions pass (no 'false' in output)
joy_test(abs)
joy_test(acos)
joy_test(all2)
joy_test(and)
joy_test(app1)
joy_test(app11)
joy_test(app12)
joy_test(app2)
joy_test(app3)
joy_test(app4)
joy_test(asin)
joy_test(assign)
joy_test(at)
joy_test(atan)
joy_test(atan2)
joy_test(binary)
joy_test(binrec)
joy_test(body)
joy_test(branch)
joy_test(case)
joy_test(cases)
joy_test(casting)
joy_test(ceil)
joy_test(char)
joy_test(choice)
joy_test(chr)
joy_test(cleave)
joy_test(compare)
joy_test(concat)
joy_test(cond)
joy_test(condlinrec)
joy_test(condnestrec)
joy_test(cons)
joy_test(construct)
joy_test(conts)
joy_test(cos)
joy_test(cosh)
joy_test(dict)
joy_test(dip)
joy_test(div)
joy_test(divide)
joy_test(drop)
joy_test(dup)
joy_test(dupd)
joy_test(enconcat)
joy_test(eql)
joy_test(eql2)
joy_test(equal)
joy_test(exp)
joy_test(false)
joy_test(filter)
joy_test(first)
joy_test(float)
joy_test(floor)
joy_test(fold)
joy_test(format)
joy_test(formatf)
joy_test(frexp)
joy_test(gc)
joy_test(genrec)
joy_test(geql)
joy_test(greater)
joy_test(has)
joy_test(i)
joy_test(id)
joy_test(ifchar)
joy_test(iffile)
joy_test(iffloat)
joy_test(ifinteger)
joy_test(iflist)
joy_test(iflogical)
joy_test(ifset)
joy_test(ifstring)
joy_test(ifte)
joy_test(in)
joy_test(infra)
joy_test(integer)
joy_test(intern)
joy_test(json)
joy_test(ldexp)
joy_test(leaf)
joy_test(leql)
joy_test(less)
joy_test(let)
joy_test(linrec)
joy_test(list)
joy_test(log)
joy_test(log10)
joy_test(logical)
joy_test(map)
joy_test(match)
joy_test(matrix)
joy_test(max)
joy_test(maxint)
joy_test(min)
joy_test(minus)
joy_test(modf)
joy_test(mul)
joy_test(name)
joy_test(neg)
joy_test(neql)
joy_test(not)
joy_test(null)
joy_test(nullary)
joy_test(of)
joy_test(opcase)
joy_test(or)
joy_test(ord)
joy_test(over)
joy_test(pick)
joy_test(plus)
joy_test(pop)
joy_test(popd)
joy_test(pow)
joy_test(pred)
joy_test(primrec)
joy_test(rem)
joy_test(rest)
joy_test(rolldown)
joy_test(rolldownd)
joy_test(rollup)
joy_test(rollupd)
joy_test(rotate)
joy_test(rotated)
joy_test(round)
joy_test(sametype)
joy_test(set)
joy_test(setsize)
joy_test(sign)
joy_test(sin)
joy_test(sinh)
joy_test(size)
joy_test(small)
joy_test(some)
joy_test(split)
joy_test(sqrt)
joy_test(stack)
joy_test(step)
joy_test(string)
joy_test(strtod)
joy_test(strtol)
joy_test(succ)
joy_test(swap)
joy_test(swapd)
joy_test(swons)
joy_test(tailrec)
joy_test(take)
joy_test(tan)
joy_test(tanh)
joy_test(ternary)
joy_test(times)
joy_test(treegenrec)
joy_test(treerec)
joy_test(treestep)
joy_test(true)
joy_test(trunc)
joy_test(typeof)
joy_test(unary)
joy_test(unary2)
joy_test(unary3)
joy_test(unary4)
joy_test(unassign)
joy_test(uncons)
joy_test(unstack)
joy_test(unswons)
joy_test(user)
joy_test(vector)
joy_test(while)
joy_test(x)
joy_test(xor)
joy_test(strinterp)
